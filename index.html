<!DOCTYPE html>
<html lang="de" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JGV Kripp - Junggesellenverein "Einigkeit"</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #3b82f6; /* blue-500 */
            --background-light: #f9fafb; /* gray-50 */
            --background-dark: #111827; /* gray-900 */
            --text-light: #1f2937;
            --text-dark: #f3f4f6;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-light);
            color: var(--text-light);
        }
        .dark body {
            background-color: var(--background-dark);
            color: var(--text-dark);
        }
        .jgv-editable { transition: outline 0.2s ease-in-out; outline: 2px dashed transparent; }
        .jgv-editing .jgv-editable { outline-color: var(--primary-color); cursor: text; }
        .jgv-editing .jgv-editable:hover { outline-style: solid; }
        .timeline { position: relative; max-width: 1200px; margin: 0 auto; }
        .timeline::after { content: ''; position: absolute; width: 6px; background-color: var(--primary-color); top: 0; bottom: 0; left: 50%; margin-left: -3px; }
        .timeline-container { padding: 10px 40px; position: relative; width: 50%; opacity: 0; transform: translateY(50px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        .timeline-container.is-visible { opacity: 1; transform: translateY(0); }
        .timeline-container.left { left: 0; }
        .timeline-container.right { left: 50%; }
        .timeline-container::after { content: ''; position: absolute; width: 25px; height: 25px; right: -12px; background-color: var(--background-light); border: 4px solid var(--primary-color); top: 15px; border-radius: 50%; z-index: 1; }
        .dark .timeline-container::after { background-color: var(--background-dark); }
        .timeline-container.right::after { left: -13px; }
        .timeline-content { padding: 20px 30px; position: relative; border-radius: 6px; }
        .details-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out; }
        @media screen and (max-width: 768px) {
            .timeline::after { left: 31px; }
            .timeline-container { width: 100%; padding-left: 70px; padding-right: 25px; }
            .timeline-container.right { left: 0%; }
            .timeline-container.left::after, .timeline-container.right::after { left: 18px; }
        }
    </style>
</head>
<body class="antialiased">
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-gray-50 dark:bg-gray-900 flex flex-col items-center justify-center z-[100] transition-opacity duration-500">
        <div class="w-16 h-16 border-4 border-blue-500 border-dashed rounded-full animate-spin"></div>
        <p class="mt-4 text-lg text-gray-800 dark:text-gray-200">Verbinde mit Datenbank...</p>
    </div>

    <!-- Admin Bar -->
    <div id="admin-bar" class="hidden fixed top-0 left-0 right-0 bg-yellow-400 text-yellow-900 px-4 py-2 flex justify-between items-center shadow-lg z-50">
        <div><i class="fas fa-exclamation-triangle mr-2"></i><span class="font-bold">Admin-Modus</span></div>
        <div>
            <button id="save-changes-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-1 px-3 rounded text-sm mr-2"><i class="fas fa-save mr-1"></i> Speichern</button>
            <button id="exit-admin-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-3 rounded text-sm"><i class="fas fa-sign-out-alt mr-1"></i> Beenden</button>
        </div>
    </div>
    
    <!-- Header -->
    <header class="bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm sticky top-0 z-40 shadow-md">
         <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="#home" class="text-2xl font-bold text-blue-500 dark:text-blue-400">JGV Kripp</a>
            <div class="hidden md:flex space-x-6 items-center text-gray-600 dark:text-gray-300">
                <a href="#home" class="nav-link hover:text-blue-500">Start</a>
                <a href="#termine" class="nav-link hover:text-blue-500">Termine</a>
                <a href="#galerie" class="nav-link hover:text-blue-500">Galerie</a>
                <a href="#verein" class="nav-link hover:text-blue-500">Der Verein</a>
                <a href="#brauchtum" class="nav-link hover:text-blue-500">Brauchtum</a>
                <a href="#vermietung" class="nav-link hover:text-blue-500">Vermietung</a>
                <a href="#kontakt" class="nav-link hover:text-blue-500">Kontakt</a>
            </div>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="text-gray-600 dark:text-gray-300 hover:text-blue-500 dark:hover:text-blue-400"><i class="fas fa-sun text-xl"></i><i class="fas fa-moon text-xl hidden"></i></button>
                <button id="login-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full transition duration-300"><i class="fas fa-user mr-2"></i>Login</button>
                <button id="logout-btn" class="hidden bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full transition duration-300"><i class="fas fa-sign-out-alt mr-2"></i>Logout</button>
                <button id="mobile-menu-btn" class="md:hidden text-gray-600 dark:text-gray-300 text-2xl"><i class="fas fa-bars"></i></button>
            </div>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden bg-white dark:bg-gray-800 py-4"><a href="#home" class="block text-center py-2 text-lg hover:bg-gray-100 dark:hover:bg-gray-700">Start</a><a href="#termine" class="block text-center py-2 text-lg hover:bg-gray-100 dark:hover:bg-gray-700">Termine</a><a href="#galerie" class="block text-center py-2 text-lg hover:bg-gray-100 dark:hover:bg-gray-700">Galerie</a><a href="#verein" class="block text-center py-2 text-lg hover:bg-gray-100 dark:hover:bg-gray-700">Der Verein</a><a href="#brauchtum" class="block text-center py-2 text-lg hover:bg-gray-100 dark:hover:bg-gray-700">Brauchtum</a><a href="#vermietung" class="block text-center py-2 text-lg hover:bg-gray-100 dark:hover:bg-gray-700">Vermietung</a><a href="#kontakt" class="block text-center py-2 text-lg hover:bg-gray-100 dark:hover:bg-gray-700">Kontakt</a><a href="#impressum" class="block text-center py-2 text-lg hover:bg-gray-100 dark:hover:bg-gray-700">Impressum</a><a href="#datenschutz" class="block text-center py-2 text-lg hover:bg-gray-100 dark:hover:bg-gray-700">Datenschutz</a></div>
    </header>

    <main id="main-content" class="text-gray-800 dark:text-gray-200">
        <!-- Sections are injected here by JavaScript -->
    </main>
    
    <footer class="bg-gray-800 dark:bg-black text-gray-300 py-8">
        <div class="container mx-auto px-6 text-center">
            <div class="flex justify-center space-x-6 mb-4">
                <a href="#" aria-label="Facebook" class="text-2xl hover:text-blue-500 transition-colors"><i class="fab fa-facebook-f"></i></a>
                <a href="#" aria-label="Instagram" class="text-2xl hover:text-pink-500 transition-colors"><i class="fab fa-instagram"></i></a>
                <a href="#" aria-label="Twitter" class="text-2xl hover:text-blue-400 transition-colors"><i class="fab fa-twitter"></i></a>
            </div>
            <div class="my-4"><a href="#impressum" class="hover:underline mx-2">Impressum</a> | <a href="#datenschutz" class="hover:underline mx-2">Datenschutz</a></div>
            <p>&copy; <span id="current-year"></span> JGV "Einigkeit" Kripp. Alle Rechte vorbehalten.</p>
        </div>
    </footer>

    <!-- Modals -->
    <div id="login-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"><div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl max-w-sm w-full"><h2 class="text-2xl font-bold mb-6 text-center">Login</h2><div class="space-y-4"><input type="password" id="password-input" placeholder="Passwort" class="w-full px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"><button id="submit-login-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Anmelden</button><button id="cancel-login-btn" class="w-full bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 font-bold py-2 px-4 rounded-lg transition duration-300">Abbrechen</button></div><p id="login-error" class="text-red-500 text-sm mt-4 text-center hidden">Falsches Passwort!</p></div></div>
    <div id="lightbox" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50"><button id="lightbox-close" class="absolute top-4 right-6 text-white text-4xl font-bold">&times;</button><img id="lightbox-img" src="" class="max-w-[90vw] max-h-[85vh] rounded-lg" alt="Lightbox Bild"></div>
    <div id="toast-notification" class="hidden fixed bottom-5 right-5 bg-green-500 text-white py-2 px-5 rounded-lg shadow-lg"><p id="toast-message"></p></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, collection, addDoc, deleteDoc, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        const initialData = {
            content: {
                'home-title': 'JGV "Einigkeit" Kripp', 'home-subtitle': 'Tradition, Gemeinschaft und Zukunft seit 1888.',
                'verein-intro-text': 'Der Junggesellenverein "Einigkeit" Kripp ist mehr als nur ein Verein – wir sind eine Gemeinschaft, die Traditionen pflegt, Feste feiert und das Dorfleben aktiv mitgestaltet. Erfahren Sie mehr über uns und werden Sie Teil unserer Geschichte.',
                'gallery-intro-text': 'Einblicke in unser Vereinsleben. Hier teilen wir die schönsten Momente unserer Feste und Aktivitäten.',
                'vermietung-intro-text': 'Unser Vereinsheim kann für private Feiern gemietet werden. Hier finden Sie alle Informationen und den Belegungskalender.',
                'vermietung-details-text': 'Unser Vereinsheim bietet Platz für bis zu 80 Personen und ist mit einer Theke, Küche und sanitären Anlagen ausgestattet. Ideal für Geburtstage, Jubiläen oder andere Feierlichkeiten. Für Terminanfragen und weitere Details kontaktieren Sie uns bitte über das Kontaktformular.',
                'kontakt-text': `Junggesellenverein "Einigkeit" Kripp<br>Musterstraße 1<br>53424 Remagen-Kripp<br><br>E-Mail: <a href="mailto:info@jgv-kripp.de" class="text-blue-500 hover:underline">info@jgv-kripp.de</a>`,
                'impressum-text': `<h3>Angaben gemäß § 5 TMG</h3><p>Junggesellenverein "Einigkeit" Kripp<br>Musterstraße 1<br>53424 Remagen-Kripp</p><p><strong>Vertreten durch:</strong><br>Max Mustermann (1. Vorsitzender)</p><h3>Kontakt</h3><p>Telefon: 0123-456789<br>E-Mail: info@jgv-kripp.de</p><h3>Haftungsausschluss</h3><p><strong>Haftung für Inhalte</strong></p><p>Die Inhalte unserer Seiten wurden mit größter Sorgfalt erstellt. Für die Richtigkeit, Vollständigkeit und Aktualität der Inhalte können wir jedoch keine Gewähr übernehmen...</p>`,
                'datenschutz-text': `<h3>1. Datenschutz auf einen Blick</h3><p><strong>Allgemeine Hinweise</strong></p><p>Die folgenden Hinweise geben einen einfachen Überblick darüber, was mit Ihren personenbezogenen Daten passiert, wenn Sie diese Website besuchen. Personenbezogene Daten sind alle Daten, mit denen Sie persönlich identifiziert werden können.</p><h3>2. Datenerfassung auf dieser Website</h3><p><strong>Wer ist verantwortlich für die Datenerfassung auf dieser Website?</strong></p><p>Die Datenverarbeitung auf dieser Website erfolgt durch den Websitebetreiber. Dessen Kontaktdaten können Sie dem Impressum dieser Website entnehmen.</p><p><em>(Dies ist ein Mustertext. Bitte lassen Sie ihn von einem Fachanwalt prüfen.)</em></p>`,
                'vermietung-li-1': '<i class="fas fa-check-circle text-green-500 mr-2"></i>Großer Festsaal', 'vermietung-li-2': '<i class="fas fa-check-circle text-green-500 mr-2"></i>Voll ausgestattete Theke', 'vermietung-li-3': '<i class="fas fa-check-circle text-green-500 mr-2"></i>Moderne Küche', 'vermietung-li-4': '<i class="fas fa-check-circle text-green-500 mr-2"></i>Außenbereich mit Sitzgelegenheiten',
                'stat-year': '1888', 'stat-members': '150', 'stat-feste': '5',
                'google-calendar-embed': `<iframe src="https://calendar.google.com/calendar/embed?height=600&wkst=2&bgcolor=%23FFFFFF&ctz=Europe%2FBerlin&title=JGV%20Kripp%20Vermietung&showTz=0&showCalendars=0&showPrint=0&src=cGxhY2Vob2xkZXI&color=%231f2937" style="border-width:0" class="w-full h-full" frameborder="0" scrolling="no"></iframe>`,
                'google-calendar-termine-embed': `<iframe src="https://calendar.google.com/calendar/embed?height=600&wkst=2&bgcolor=%23FFFFFF&ctz=Europe%2FBerlin&title=JGV%20Kripp%20Termine&src=cGxhY2Vob2xkZXI&color=%231f2937" style="border:solid 1px #777" class="w-full h-full" frameborder="0" scrolling="no"></iframe>`,
                'vorstand-text': `<p class="text-lg text-gray-600 dark:text-gray-400 mb-6">Der Vorstand (8 Personen) leitet die Geschicke des Vereins, vertritt ihn nach außen und trifft strategische Entscheidungen. Er ist das Herz der Vereinsorganisation.</p><ul class="space-y-3 text-left max-w-md mx-auto"><li class="flex justify-between items-center"><span class="font-bold">1. Vorsitzender:</span> <span>Max Mustermann</span></li><li class="flex justify-between items-center"><span class="font-bold">2. Vorsitzender:</span> <span>Peter Müller</span></li><li class="flex justify-between items-center"><span class="font-bold">1. Kassierer:</span> <span>Jens Schmidt</span></li><li class="flex justify-between items-center"><span class="font-bold">2. Kassierer:</span> <span>Tom Becker</span></li><li class="flex justify-between items-center"><span class="font-bold">1. Schriftführer:</span> <span>Klaus Weber</span></li><li class="flex justify-between items-center"><span class="font-bold">2. Schriftführer:</span> <span>Lukas Klein</span></li><li class="flex justify-between items-center"><span class="font-bold">1. Beisitzer:</span> <span>Nico Berg</span></li><li class="flex justify-between items-center"><span class="font-bold">2. Beisitzer:</span> <span>Tim Wolf</span></li></ul>`,
                'festausschuss-text': `<p class="text-lg text-gray-600 dark:text-gray-400 mb-6">Der Festausschuss (16 Personen) ist das kreative Herz des Vereins. Er plant und organisiert unvergessliche Veranstaltungen wie die Kirmes und das Sommerfest, kümmert sich um Dekoration, Musik und das leibliche Wohl.</p>`,
                'martinsausschuss-text': `<p class="text-lg text-gray-600 dark:text-gray-400 mb-6">Dieser Ausschuss (6 Personen) kümmert sich speziell um die Organisation des traditionellen St. Martinszugs in Kripp, vom Martinsfeuer bis zur Ausgabe der Weckmänner an die Kinder.</p>`,
                'amtstraeger-text': `<p class="text-lg text-gray-600 dark:text-gray-400 mb-6">Die Amtsträger repräsentieren den Verein bei offiziellen Anlässen und Festzügen. Sie sind die Hüter wichtiger Traditionen wie dem Fähndelschwenken.</p><ul class="space-y-3 text-left max-w-md mx-auto"><li class="flex justify-between items-center"><span class="font-bold">König (2025):</span> <span>Christian Laux</span></li><li class="flex justify-between items-center"><span class="font-bold">Hauptmann:</span> <span>Stefan Meier</span></li><li class="flex justify-between items-center"><span class="font-bold">Leutnant:</span> <span>Thomas Becker</span></li></ul>`,
                'geschichte-text': `Gegründet im Jahre 1888, wurde das Vereinsleben durch den 1. Weltkrieg unterbrochen. Danach erblühte es neu, und das Königsschießen wurde eingeführt. Ein Meilenstein war die Gründung des Tambourcorps am 14. Mai 1949, das bis heute ein wichtiger Teil des Vereins ist. Die Königskette symbolisiert die Verbundenheit über Generationen hinweg, da ihr alter Teil den Krieg vergraben überstand und später geborgen wurde.`,
                'kirmes-text': 'Die Kripper Kirmes ist das größte Fest im Dorf und der Höhepunkt unseres Vereinsjahres. Vier Tage lang wird im Festzelt gefeiert, getanzt und gelacht. Vom Fassanstich am Freitag bis zum Königsball am Montag ist für Jung und Alt etwas geboten.',
                'maiabend-text': 'Der Maiabend leitet traditionell den Wonnemonat ein. Mit dem Aufstellen des Maibaums am Dorfplatz und dem anschließenden Fest wird der Frühling in Kripp gebührend begrüßt.',
                'strohbaertreiben-text': 'Ein besonderer Brauch ist das Strohbärtreiben an Karneval, bei dem der Winter symbolisch ausgetrieben wird – eine Tradition, die seit 1927 ohne Unterbrechung gepflegt wird. Der in Stroh gewickelte Bär wird von den Kindern durchs Dorf getrieben.',
                'martinstag-text': 'Am Martinstag begleiten wir den Martinszug durch das Dorf und helfen bei der Organisation des großen Martinsfeuers. Im Anschluss erhalten die Kinder traditionell ihre Weckmänner.',
                'faehndelschwenken-text': 'Das Fähndelschwenken ist eine hohe Kunst und fester Bestandteil unserer Festzüge. Unsere Fähnriche repräsentieren den Verein mit Stolz und Eleganz. Das Schwenken der großen Vereinsfahne erfordert Kraft, Geschick und viel Übung.'
            },
            events: [
                { id: 'evt1', date: '2025-11-11', title: 'St. Martin', description: 'Begleitung des St. Martinszugs durch das Dorf mit anschließendem Martinsfeuer.', type: 'public', details: 'Wir treffen uns um 17:30 Uhr an der Grundschule, um den Zug mit Fackeln zu begleiten. Im Anschluss gibt es am Martinsfeuer Glühwein und Kinderpunsch für alle Helfer.' },
                { id: 'evt2', date: '2026-05-28', title: 'Kirmes-Wochenende', description: 'Das Highlight des Jahres! Kirmes in Kripp mit Live-Musik und Königsball.', type: 'public', details: 'Freitag: 90er Party mit DJ. Samstag: Kölsche Nacht. Sonntag: Bürgerfrühstück und Familiennachmittag. Montag: Traditioneller Königsball.' },
                { id: 'evt3', date: '2026-08-15', title: 'Sommerfest', description: 'Großes Sommerfest für Mitglieder und Freunde des Vereins mit Grillen und kühlen Getränken.', type: 'public', details: 'Ab 15 Uhr auf dem Vereinsgelände. Für das leibliche Wohl ist bestens gesorgt. Wir freuen uns auf einen gemütlichen Nachmittag mit euch!' },
                { id: 'evt4', date: '2025-12-20', title: 'Weihnachtsfeier', description: 'Interne Weihnachtsfeier für alle Mitglieder.', type: 'internal', details: 'Unsere jährliche Weihnachtsfeier findet im Vereinsheim statt. Beginn ist um 19 Uhr. Bitte tragt euch in die Liste im Mitgliederbereich für das Essen ein.' },
                { id: 'evt5', date: '2025-09-10', title: 'Vergangenes Event', description: 'Dies ist ein Test für ein vergangenes Event.', type: 'public', details: 'Hier standen die Details des vergangenen Events.' }
            ],
            koenigsarchiv: [ { year: 2025, name: 'Christian Laux' }, { year: 2024, name: 'Tim Weber' }, { year: 2023, name: 'Martin Doll' }, { year: 2022, name: 'Lukas Boes' }, { year: 2020, name: 'COVID-19 Pause' }, { year: 2019, name: 'Niklas Reich' } ],
            gallery: Array.from({ length: 12 }, (_, i) => ({ id: i + 1, thumb: `https://placehold.co/400x300/60a5fa/ffffff?text=Foto+${i+1}`, full: `https://placehold.co/1200x900/60a5fa/ffffff?text=Foto+${i+1}` })),
            memberData: { koenigstipp: { locked: false, winner: null, tips: [{ user: 'Max M.', tip: 'Peter Schmidt' }] }, dienstplan: { 'freitag-theke-1': null, 'freitag-theke-2': 'Klaus B.' } }
        };

        let db, auth, appId;
        let detachListeners = () => {};
        const state = { authLevel: 'public', content: {}, events: [], memberData: { koenigstipp: { tips: [] }, dienstplan: {} }, koenigsarchiv: [], gallery: initialData.gallery };
        
        document.addEventListener('DOMContentLoaded', async () => {
            setLogLevel('error');
            document.getElementById('current-year').textContent = new Date().getFullYear();
            renderMainContent();
            setupStaticEventListeners();
            await initFirebase();
        });

        async function initFirebase() {
            const firebaseConfig = {
              apiKey: "AIzaSyCSPvQ7aKgtqRZUlMAaU6Pey9L6gNapVrY",
              authDomain: "jgv-kripp-live.firebaseapp.com",
              projectId: "jgv-kripp-live",
              storageBucket: "jgv-kripp-live.firebasestorage.app",
              messagingSenderId: "929549010814",
              appId: "1:929549010814:web:45fb1738c0a7a1f466152f"
            };
            
            appId = `jgv-data-${firebaseConfig.projectId}`;

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                onAuthStateChanged(auth, user => {
                    if (user) {
                        console.log("Firebase Auth User:", user.uid);
                        seedInitialData().then(() => attachFirestoreListeners());
                    } else {
                        signInAnonymously(auth).catch(error => {
                            console.error("Anonymous sign-in failed:", error);
                            document.getElementById('loading-overlay').innerHTML = '<p class="text-red-500">Verbindung zur Datenbank fehlgeschlagen. Bitte Admin-Einstellungen in Firebase prüfen.</p>';
                        });
                    }
                });
            } catch (e) {
                console.error("Firebase initialization failed:", e);
                document.getElementById('loading-overlay').innerHTML = '<p class="text-red-500">Webseite konnte nicht initialisiert werden.</p>';
            }
        }
        
        async function seedInitialData() {
            const dataDocRef = doc(db, "jgv-website-data", appId);
            const dataSnap = await getDoc(dataDocRef);

            if (!dataSnap.exists()) {
                console.log("Seeding database...");
                const initialDbData = {
                    content: initialData.content,
                    memberData: initialData.memberData,
                    koenigsarchiv: initialData.koenigsarchiv
                };
                await setDoc(dataDocRef, initialDbData);

                const eventsColRef = collection(db, "jgv-website-data", appId, "events");
                for (const event of initialData.events) {
                    await addDoc(eventsColRef, event);
                }
                console.log("Database seeded.");
            }
        }

        function attachFirestoreListeners() {
            detachListeners();
            const dataDocRef = doc(db, "jgv-website-data", appId);
            const eventsColRef = collection(db, "jgv-website-data", appId, "events");

            const unsub1 = onSnapshot(dataDocRef, d => {
                const data = d.data() || {};
                state.content = data.content || {};
                state.memberData = data.memberData || { koenigstipp: { tips: [] }, dienstplan: {} };
                state.koenigsarchiv = data.koenigsarchiv || [];
                renderContent();
            });

            const unsub2 = onSnapshot(query(eventsColRef), s => {
                state.events = s.docs.map(d => ({ id: d.id, ...d.data() }));
                renderDynamicContent();
            });
            
            detachListeners = () => { unsub1(); unsub2(); };
            
            const loadingOverlay = document.getElementById('loading-overlay');
            loadingOverlay.classList.add('opacity-0');
            setTimeout(() => loadingOverlay.classList.add('hidden'), 500);
        }
        
        function renderContent() { renderEditableContent(); renderCurrentTabs(); }
        function renderDynamicContent() { renderTimeline(); renderNextEventHome(); }
        
        function renderMainContent() {
            if (document.getElementById('home')) return;
            document.getElementById('main-content').innerHTML = `
                <section id="home" class="page-section min-h-screen flex items-center justify-center text-center bg-cover bg-center" style="background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://placehold.co/1920x1080/3b82f6/ffffff?text=Vereinsleben');"><div class="container mx-auto px-6 text-white"><h1 id="home-title" class="jgv-editable text-5xl md:text-7xl font-black mb-4"></h1><p id="home-subtitle" class="jgv-editable text-xl md:text-2xl mb-8"></p><div class="bg-white/20 dark:bg-black/30 backdrop-blur-md p-6 rounded-lg max-w-4xl mx-auto"><h2 class="text-2xl font-bold mb-3">Das nächste Highlight</h2><div id="next-event-container-home" class="text-lg"></div></div></div></section>
                <section id="home-intro" class="page-section py-20 bg-gray-50 dark:bg-gray-900"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Willkommen beim JGV Kripp</h2><p id="verein-intro-text" class="jgv-editable max-w-3xl mx-auto text-lg text-gray-600 dark:text-gray-400"></p></div><div class="mt-12"><div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center"><div><i class="fas fa-calendar-alt text-4xl text-blue-500 mb-4"></i><h3 id="stat-year" class="jgv-editable text-5xl font-bold"></h3><p class="text-gray-500 dark:text-gray-400 mt-2">Gründungsjahr</p></div><div><i class="fas fa-users text-4xl text-blue-500 mb-4"></i><h3 id="stat-members" class="jgv-editable text-5xl font-bold"></h3><p class="text-gray-500 dark:text-gray-400 mt-2">Mitglieder</p></div><div><i class="fas fa-glass-cheers text-4xl text-blue-500 mb-4"></i><h3 id="stat-feste" class="jgv-editable text-5xl font-bold"></h3><p class="text-gray-500 dark:text-gray-400 mt-2">Jährliche Feste</p></div></div></div></div></section>
                <section id="termine" class="page-section py-20"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Unsere Termine</h2><p class="max-w-3xl mx-auto text-lg text-gray-600 dark:text-gray-400">Hier finden Sie eine Übersicht über alle kommenden und vergangenen Veranstaltungen.</p></div><div class="mb-12 bg-white dark:bg-gray-800 p-2 sm:p-3 rounded-lg shadow-lg overflow-hidden max-w-4xl mx-auto"><div id="google-calendar-termine-embed" class="jgv-editable aspect-w-16 aspect-h-9"></div></div><div id="admin-event-form-container"></div><div id="timeline-container" class="timeline"></div></div></section>
                <section id="galerie" class="page-section py-20 bg-gray-50 dark:bg-gray-900"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Fotogalerie</h2><p id="gallery-intro-text" class="jgv-editable max-w-3xl mx-auto text-lg text-gray-600 dark:text-gray-400"></p></div><div id="gallery-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div></div></section>
                <section id="verein" class="page-section py-20"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Unser Verein</h2><p class="max-w-3xl mx-auto text-lg text-gray-600 dark:text-gray-400">Lernen Sie die Menschen kennen, die den Verein gestalten und führen.</p><div class="flex flex-wrap justify-center gap-2 mt-6"><button data-verein-tab="vorstand" class="verein-tab-btn bg-blue-500 text-white py-2 px-4 rounded-full">Vorstand</button><button data-verein-tab="amtstraeger" class="verein-tab-btn bg-gray-200 dark:bg-gray-700 py-2 px-4 rounded-full">Amtsträger</button><button data-verein-tab="festausschuss" class="verein-tab-btn bg-gray-200 dark:bg-gray-700 py-2 px-4 rounded-full">Festausschuss</button><button data-verein-tab="martinsausschuss" class="verein-tab-btn bg-gray-200 dark:bg-gray-700 py-2 px-4 rounded-full">Martinsausschuss</button></div></div><div id="verein-content" class="mt-8"></div></div></section>
                <section id="brauchtum" class="page-section py-20 bg-gray-50 dark:bg-gray-900"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Brauchtum & Tradition</h2><p class="max-w-3xl mx-auto text-lg text-gray-600 dark:text-gray-400">Entdecken Sie die reiche Geschichte und die gelebten Traditionen unseres Vereins.</p><div class="flex flex-wrap justify-center gap-2 mt-6"><button data-brauchtum-tab="geschichte" class="brauchtum-tab-btn bg-blue-500 text-white py-2 px-4 rounded-full">Geschichte</button><button data-brauchtum-tab="chronik" class="brauchtum-tab-btn bg-gray-200 dark:bg-gray-700 py-2 px-4 rounded-full">Chronik der Könige</button><button data-brauchtum-tab="kirmes" class="brauchtum-tab-btn bg-gray-200 dark:bg-gray-700 py-2 px-4 rounded-full">Kirmes</button><button data-brauchtum-tab="maiabend" class="brauchtum-tab-btn bg-gray-200 dark:bg-gray-700 py-2 px-4 rounded-full">Maiabend</button><button data-brauchtum-tab="strohbaertreiben" class="brauchtum-tab-btn bg-gray-200 dark:bg-gray-700 py-2 px-4 rounded-full">Strohbärtreiben</button><button data-brauchtum-tab="martinstag" class="brauchtum-tab-btn bg-gray-200 dark:bg-gray-700 py-2 px-4 rounded-full">Martinstag</button><button data-brauchtum-tab="faehndelschwenken" class="brauchtum-tab-btn bg-gray-200 dark:bg-gray-700 py-2 px-4 rounded-full">Fähndelschwenken</button></div></div><div id="brauchtum-content" class="mt-8"></div></div></section>
                <section id="vermietung" class="page-section py-20"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Vermietung Vereinsheim</h2><p id="vermietung-intro-text" class="jgv-editable max-w-3xl mx-auto text-lg text-gray-600 dark:text-gray-400"></p></div><div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center"><div><h3 class="text-2xl font-bold mb-4">Informationen</h3><p id="vermietung-details-text" class="jgv-editable text-gray-700 dark:text-gray-300 mb-4"></p><ul class="space-y-2"><li class="jgv-editable" data-id="vermietung-li-1"></li><li class="jgv-editable" data-id="vermietung-li-2"></li><li class="jgv-editable" data-id="vermietung-li-3"></li><li class="jgv-editable" data-id="vermietung-li-4"></li></ul></div><div class="bg-white dark:bg-gray-800 p-2 sm:p-3 rounded-lg shadow-lg overflow-hidden"><div id="google-calendar-embed" class="jgv-editable aspect-w-4 aspect-h-3"></div></div></div></div></section>
                <section id="kontakt" class="page-section py-20 bg-gray-50 dark:bg-gray-900"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Kontakt</h2></div><div class="max-w-xl mx-auto bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg text-center"><p id="kontakt-text" class="jgv-editable text-lg"></p></div></div></section>
                <section id="impressum" class="page-section py-20"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Impressum</h2></div><div class="max-w-2xl mx-auto bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg"><div id="impressum-text" class="jgv-editable prose dark:prose-invert max-w-none"></div></div></div></section>
                <section id="datenschutz" class="page-section py-20 bg-gray-50 dark:bg-gray-900"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Datenschutzerklärung</h2></div><div class="max-w-2xl mx-auto bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg"><div id="datenschutz-text" class="jgv-editable prose dark:prose-invert max-w-none"></div></div></div></section>
                <section id="member-area" class="page-section hidden py-20 bg-blue-50 dark:bg-gray-800"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Mitgliederbereich</h2><p class="max-w-3xl mx-auto text-lg text-gray-600 dark:text-gray-400">Willkommen im exklusiven Bereich für unsere Vereinsmitglieder.</p><div class="flex justify-center space-x-2 mt-6"><button data-member-tab="koenigstipp" class="member-tab-btn bg-blue-500 text-white py-2 px-4 rounded-full">Königstipp</button><button data-member-tab="dienstplan" class="member-tab-btn bg-gray-200 dark:bg-gray-700 py-2 px-4 rounded-full">Dienstplan</button><button data-member-tab="dokumente" class="member-tab-btn bg-gray-200 dark:bg-gray-700 py-2 px-4 rounded-full">Dokumente</button></div></div><div id="member-content" class="mt-8"></div></div></section>
            `;
            renderGallery();
        }
        
        function setupStaticEventListeners() {
            document.getElementById('theme-toggle').addEventListener('click', () => document.documentElement.classList.toggle('dark'));
            document.getElementById('mobile-menu-btn').addEventListener('click', () => document.getElementById('mobile-menu').classList.toggle('hidden'));
            document.querySelectorAll('a[href^="#"]').forEach(a => a.addEventListener('click', function(e) { e.preventDefault(); navigateTo(this.getAttribute('href').substring(1)); document.getElementById('mobile-menu').classList.add('hidden'); }));
            document.getElementById('login-btn').addEventListener('click', () => document.getElementById('login-modal').classList.remove('hidden'));
            document.getElementById('cancel-login-btn').addEventListener('click', () => document.getElementById('login-modal').classList.add('hidden'));
            document.getElementById('submit-login-btn').addEventListener('click', handleLogin);
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            document.getElementById('save-changes-btn').addEventListener('click', saveContentChanges);
            document.getElementById('exit-admin-btn').addEventListener('click', handleLogout);
            document.getElementById('lightbox-close').addEventListener('click', () => document.getElementById('lightbox').classList.add('hidden'));
            document.getElementById('main-content').addEventListener('click', (e) => {
                const toggleBtn = e.target.closest('[data-toggle-details]');
                if (toggleBtn) {
                    const eventId = toggleBtn.dataset.toggleDetails;
                    const detailsDiv = document.getElementById(`details-${eventId}`);
                    const icon = toggleBtn.querySelector('i');
                    if (detailsDiv) {
                        icon?.classList.toggle('rotate-180');
                        detailsDiv.style.maxHeight = detailsDiv.style.maxHeight ? null : detailsDiv.scrollHeight + "px";
                    }
                }
                 if (e.target.closest('.verein-tab-btn')) {
                    const btn = e.target.closest('.verein-tab-btn');
                    document.querySelectorAll('.verein-tab-btn').forEach(b => { b.classList.remove('bg-blue-500', 'text-white'); b.classList.add('bg-gray-200', 'dark:bg-gray-700'); });
                    btn.classList.add('bg-blue-500', 'text-white'); btn.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                    renderVereinContent(btn.dataset.vereinTab);
                }
                if (e.target.closest('.brauchtum-tab-btn')) {
                    const btn = e.target.closest('.brauchtum-tab-btn');
                    document.querySelectorAll('.brauchtum-tab-btn').forEach(b => { b.classList.remove('bg-blue-500', 'text-white'); b.classList.add('bg-gray-200', 'dark:bg-gray-700'); });
                    btn.classList.add('bg-blue-500', 'text-white'); btn.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                    renderBrauchtumContent(btn.dataset.brauchtumTab);
                }
            });
             document.querySelector('#member-area').addEventListener('click', (e) => {
                if (e.target.closest('.member-tab-btn')) {
                    const btn = e.target.closest('.member-tab-btn');
                    document.querySelectorAll('#member-area .member-tab-btn').forEach(b => { b.classList.remove('bg-blue-500', 'text-white'); b.classList.add('bg-gray-200', 'dark:bg-gray-700'); });
                    btn.classList.add('bg-blue-500', 'text-white'); btn.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                    renderMemberContent(btn.dataset.memberTab);
                }
            });
            document.getElementById('member-content').addEventListener('submit', handleMemberAreaSubmits);
            document.getElementById('member-content').addEventListener('click', handleMemberAreaClicks);
        }
        function renderVereinContent(tab) { /* ... same as before ... */ }
        function renderBrauchtumContent(tab) { /* ... same as before ... */ }
        function renderKoenigsarchiv() { /* ... same as before ... */ }
        function renderMemberContent(tab) { /* ... same as before ... */ }
        function navigateTo(pageId) { /* ... same as before ... */ }
        function handleLogin() { /* ... same as before ... */ }
        function handleLogout() { /* ... same as before ... */ }
        function updateUIforAuthState() { /* ... same as before ... */ }
        async function saveContentChanges() { /* ... same as before ... */ }
        function renderAdminEventForm() { /* ... same as before ... */ }
        async function handleEventFormSubmit(e) { /* ... same as before ... */ }
        function resetEventForm() { /* ... same as before ... */ }
        window.openEventEditor = (eventId) => { /* ... same as before ... */ }
        window.deleteEvent = async (eventId) => { /* ... same as before ... */ }
        async function handleMemberAreaSubmits(e) { /* ... same as before ... */ }
        async function handleMemberAreaClicks(e) { /* ... same as before ... */ }
        function showToast(message, type = 'success') { /* ... same as before ... */ }
    </script>
</body>
</html>

