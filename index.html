<!DOCTYPE html>
<html lang="de" class="scroll-smooth dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JGV Kripp - Junggesellenverein "Einigkeit"</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
    
    <style>
        :root {
            --primary-color: #3b82f6; /* blue-500 */
            --background-dark: #111827; /* gray-900 */
            --text-dark: #f3f4f6;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-dark);
            color: var(--text-dark);
        }
        #pannellum-container { width: 100%; height: 60vh; }
        .timeline { position: relative; max-width: 1200px; margin: 0 auto; }
        .timeline::after { content: ''; position: absolute; width: 6px; background-color: var(--primary-color); top: 0; bottom: 0; left: 50%; margin-left: -3px; }
        .timeline-container { padding: 10px 40px; position: relative; width: 50%; opacity: 0; transform: translateY(50px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        .timeline-container.is-visible { opacity: 1; transform: translateY(0); }
        .timeline-container.left { left: 0; }
        .timeline-container.right { left: 50%; }
        .timeline-container::after { content: ''; position: absolute; width: 25px; height: 25px; right: -12px; background-color: var(--background-dark); border: 4px solid var(--primary-color); top: 15px; border-radius: 50%; z-index: 1; }
        .timeline-container.right::after { left: -13px; }
        .timeline-content { padding: 20px 30px; position: relative; border-radius: 6px; }
        .details-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out; }
        @media screen and (max-width: 768px) {
            .timeline::after { left: 31px; }
            .timeline-container { width: 100%; padding-left: 70px; padding-right: 25px; }
            .timeline-container.right { left: 0%; }
            .timeline-container.left::after, .timeline-container.right::after { left: 18px; }
        }
    </style>
</head>
<body class="antialiased">
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-gray-900 flex flex-col items-center justify-center z-[100] transition-opacity duration-500">
        <div class="w-16 h-16 border-4 border-blue-500 border-dashed rounded-full animate-spin"></div>
        <p class="mt-4 text-lg text-gray-200">Verbinde mit Datenbank...</p>
    </div>
    
    <!-- Header -->
    <header class="bg-gray-900/80 backdrop-blur-sm sticky top-0 z-40 shadow-md">
         <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="#home" class="text-2xl font-bold text-blue-400">JGV Kripp</a>
            <div class="hidden md:flex space-x-6 items-center text-gray-300">
                <a href="#home" class="nav-link hover:text-blue-400">Start</a>
                <a href="#termine" class="nav-link hover:text-blue-400">Termine</a>
                <a href="#kirmeszelt" class="nav-link hover:text-blue-400">Kirmeszelt 3D</a>
                <a href="#galerie" class="nav-link hover:text-blue-400">Galerie</a>
                <a href="#verein" class="nav-link hover:text-blue-400">Der Verein</a>
                <a href="#brauchtum" class="nav-link hover:text-blue-400">Brauchtum</a>
            </div>
            <div class="flex items-center space-x-4">
                <a href="#admin-dashboard" id="admin-dashboard-link" class="hidden bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-full transition duration-300"><i class="fas fa-tachometer-alt mr-2"></i>Dashboard</a>
                <button id="login-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full transition duration-300"><i class="fas fa-user mr-2"></i>Login</button>
                <button id="logout-btn" class="hidden bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full transition duration-300"><i class="fas fa-sign-out-alt mr-2"></i>Logout</button>
                <button id="mobile-menu-btn" class="md:hidden text-gray-300 text-2xl"><i class="fas fa-bars"></i></button>
            </div>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden bg-gray-800 py-4"><a href="#home" class="block text-center py-2 text-lg hover:bg-gray-700">Start</a><a href="#termine" class="block text-center py-2 text-lg hover:bg-gray-700">Termine</a><a href="#kirmeszelt" class="block text-center py-2 text-lg hover:bg-gray-700">Kirmeszelt 3D</a><a href="#galerie" class="block text-center py-2 text-lg hover:bg-gray-700">Galerie</a><a href="#verein" class="block text-center py-2 text-lg hover:bg-gray-700">Der Verein</a><a href="#brauchtum" class="block text-center py-2 text-lg hover:bg-gray-700">Brauchtum</a><a href="#impressum" class="block text-center py-2 text-lg hover:bg-gray-700">Impressum</a><a href="#datenschutz" class="block text-center py-2 text-lg hover:bg-gray-700">Datenschutz</a></div>
    </header>

    <main id="main-content" class="text-gray-200">
        <!-- Sections are injected here by JavaScript -->
    </main>
    
    <footer class="bg-gray-800 dark:bg-black text-gray-300 py-8">
        <div class="container mx-auto px-6 text-center">
            <div class="flex justify-center space-x-6 mb-4">
                <a href="#" aria-label="Facebook" class="text-2xl hover:text-blue-500 transition-colors"><i class="fab fa-facebook-f"></i></a>
                <a href="#" aria-label="Instagram" class="text-2xl hover:text-pink-500 transition-colors"><i class="fab fa-instagram"></i></a>
                <a href="#" aria-label="Twitter" class="text-2xl hover:text-blue-400 transition-colors"><i class="fab fa-twitter"></i></a>
            </div>
            <div class="my-4"><a href="#impressum" class="hover:underline mx-2">Impressum</a> | <a href="#datenschutz" class="hover:underline mx-2">Datenschutz</a></div>
            <p>&copy; <span id="current-year"></span> JGV "Einigkeit" Kripp. Alle Rechte vorbehalten. <span class="text-xs text-gray-600 ml-2">v2.0.0</span></p>
        </div>
    </footer>

    <!-- Modals -->
    <div id="login-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"><div class="bg-gray-800 p-8 rounded-lg shadow-xl max-w-sm w-full"><h2 class="text-2xl font-bold mb-6 text-center">Login</h2><div class="space-y-4"><input type="password" id="password-input" placeholder="Passwort" class="w-full px-4 py-2 border rounded-lg bg-gray-700 border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"><button id="submit-login-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">Anmelden</button><button id="cancel-login-btn" class="w-full bg-gray-600 hover:bg-gray-500 font-bold py-2 px-4 rounded-lg transition duration-300">Abbrechen</button></div><p id="login-error" class="text-red-500 text-sm mt-4 text-center hidden">Falsches Passwort!</p></div></div>
    <div id="lightbox" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50"><button id="lightbox-close" class="absolute top-4 right-6 text-white text-4xl font-bold">&times;</button><img id="lightbox-img" src="" class="max-w-[90vw] max-h-[85vh] rounded-lg" alt="Lightbox Bild"></div>
    <div id="toast-notification" class="hidden fixed bottom-5 right-5 bg-green-500 text-white py-2 px-5 rounded-lg shadow-lg"><p id="toast-message"></p></div>

    <script type="module">
        // --- Firebase SDK Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, collection, addDoc, deleteDoc, query, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        // --- Initial Data for Seeding ---
        const initialData = {
             // ... (initial data remains the same as previous version, omitted for brevity)
        };
        
        // --- App State & Firebase Refs ---
        let db, auth, appId;
        let detachListeners = () => {};
        const state = { authLevel: 'public', content: {}, events: [], memberData: {}, koenigsarchiv: [], gallery: [], rosters: [] };

        // --- CORE INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', async () => {
            setLogLevel('error');
            document.getElementById('current-year').textContent = new Date().getFullYear();
            renderMainContent();
            setupStaticEventListeners();
            await initFirebase();
        });

        async function initFirebase() {
             const firebaseConfig = {
              apiKey: "AIzaSyCSPvQ7aKgtqRZUlMAaU6Pey9L6gNapVrY",
              authDomain: "jgv-kripp-live.firebaseapp.com",
              projectId: "jgv-kripp-live",
              storageBucket: "jgv-kripp-live.firebasestorage.app",
              messagingSenderId: "929549010814",
              appId: "1:929549010814:web:45fb1738c0a7a1f466152f"
            };
            appId = `jgv-data-${firebaseConfig.projectId}`;
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                onAuthStateChanged(auth, user => {
                    if (user) {
                        seedInitialData().then(() => attachFirestoreListeners());
                    } else {
                        signInAnonymously(auth);
                    }
                });
            } catch (e) {
                console.error("Firebase init failed:", e);
                document.getElementById('loading-overlay').innerHTML = '<p class="text-red-500">Webseite konnte nicht initialisiert werden.</p>';
            }
        }
        
        async function seedInitialData() { /* ... (Seeding logic remains the same) */ }

        function attachFirestoreListeners() {
            detachListeners();
            const dataDocRef = doc(db, "jgv-website-data", appId);
            const eventsColRef = collection(db, "jgv-website-data", appId, "events");
            const rostersColRef = collection(db, "jgv-website-data", appId, "rosters");

            const unsub1 = onSnapshot(dataDocRef, d => {
                const data = d.data() || {};
                state.content = data.content || {};
                state.gallery = data.gallery || [];
                state.memberData = data.memberData || {};
                state.koenigsarchiv = data.koenigsarchiv || [];
                renderStaticContent();
            });
            const unsub2 = onSnapshot(query(eventsColRef), s => { state.events = s.docs.map(d => ({ id: d.id, ...d.data() })); renderDynamicContent(); });
            const unsub3 = onSnapshot(query(rostersColRef), s => { state.rosters = s.docs.map(d => ({ id: d.id, ...d.data() })); renderDashboardRosters(); renderMemberContent('dienstplan'); });
            
            detachListeners = () => { unsub1(); unsub2(); unsub3(); };
            
            const loadingOverlay = document.getElementById('loading-overlay');
            loadingOverlay.classList.add('opacity-0');
            setTimeout(() => {
                loadingOverlay.classList.add('hidden');
                navigateTo(window.location.hash.substring(1) || 'home');
            }, 500);
        }
        
        // --- RENDER FUNCTIONS ---
        function renderStaticContent() { renderEditableContent(); renderCurrentTabs(); renderDynamicStyles(); renderGallery(); }
        function renderDynamicContent() { renderTimeline(); renderNextEventHome(); renderThrowbackPhoto(); }
        
        function renderMainContent() {
             if (document.getElementById('home')) return;
            document.getElementById('main-content').innerHTML = `
                <section id="home" class="page-section min-h-screen flex items-center justify-center text-center bg-cover bg-center bg-fixed relative"><div class="container mx-auto px-6 text-white"><h1 id="home-title" class="text-5xl md:text-7xl font-black mb-4"></h1><p id="home-subtitle" class="text-xl md:text-2xl mb-8"></p><div class="bg-black/30 backdrop-blur-md p-6 rounded-lg max-w-4xl mx-auto"><h2 class="text-2xl font-bold mb-3">Das nächste Highlight</h2><div id="next-event-container-home" class="text-lg"></div></div></div></section>
                <section id="home-intro" class="page-section py-20 bg-gray-900"><div class="container mx-auto px-6"><div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center"><div class="text-center md:text-left"><h2 class="text-4xl font-bold mb-4">Willkommen beim JGV Kripp</h2><p id="verein-intro-text" class="max-w-xl text-lg text-gray-400"></p></div><div id="throwback-photo-container"></div></div><div class="mt-20"><div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center"><div><i class="fas fa-calendar-alt text-4xl text-blue-400 mb-4"></i><h3 id="stat-year" class="text-5xl font-bold"></h3><p class="text-gray-400 mt-2">Gründungsjahr</p></div><div><i class="fas fa-users text-4xl text-blue-400 mb-4"></i><h3 id="stat-members" class="text-5xl font-bold"></h3><p class="text-gray-400 mt-2">Mitglieder</p></div><div><i class="fas fa-glass-cheers text-4xl text-blue-400 mb-4"></i><h3 id="stat-feste" class="text-5xl font-bold"></h3><p class="text-gray-400 mt-2">Jährliche Feste</p></div></div></div></div></section>
                <section id="termine" class="page-section hidden py-20"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Unsere Termine</h2><p class="max-w-3xl mx-auto text-lg text-gray-400">Hier finden Sie eine Übersicht über alle kommenden und vergangenen Veranstaltungen.</p></div><div id="timeline-container" class="timeline"></div></div></section>
                <section id="kirmeszelt" class="page-section hidden py-20"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">3D-Rundgang Kirmeszelt</h2><p class="max-w-3xl mx-auto text-lg text-gray-400">Erleben Sie unser Festzelt in 360 Grad! (Beispielbild)</p></div><div id="pannellum-container" class="rounded-lg shadow-lg"></div></div></section>
                <section id="galerie" class="page-section hidden py-20 bg-gray-900"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Fotogalerie</h2><p id="gallery-intro-text" class="max-w-3xl mx-auto text-lg text-gray-400"></p></div><div id="gallery-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div></div></section>
                <section id="verein" class="page-section hidden py-20"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Unser Verein</h2><p class="max-w-3xl mx-auto text-lg text-gray-400">Lernen Sie die Menschen kennen, die den Verein gestalten und führen.</p><div class="flex flex-wrap justify-center gap-2 mt-6"><button data-verein-tab="vorstand" class="verein-tab-btn bg-blue-500 text-white py-2 px-4 rounded-full">Vorstand</button><button data-verein-tab="amtstraeger" class="verein-tab-btn bg-gray-700 py-2 px-4 rounded-full">Amtsträger</button><button data-verein-tab="festausschuss" class="verein-tab-btn bg-gray-700 py-2 px-4 rounded-full">Festausschuss</button><button data-verein-tab="martinsausschuss" class="verein-tab-btn bg-gray-700 py-2 px-4 rounded-full">Martinsausschuss</button></div></div><div id="verein-content" class="mt-8"></div></div></section>
                <section id="brauchtum" class="page-section hidden py-20 bg-gray-900"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Brauchtum & Tradition</h2><p class="max-w-3xl mx-auto text-lg text-gray-400">Entdecken Sie die reiche Geschichte und die gelebten Traditionen unseres Vereins.</p><div class="flex flex-wrap justify-center gap-2 mt-6"><button data-brauchtum-tab="geschichte" class="brauchtum-tab-btn bg-blue-500 text-white py-2 px-4 rounded-full">Geschichte</button><button data-brauchtum-tab="chronik" class="brauchtum-tab-btn bg-gray-700 py-2 px-4 rounded-full">Chronik der Könige</button><button data-brauchtum-tab="kirmes" class="brauchtum-tab-btn bg-gray-700 py-2 px-4 rounded-full">Kirmes</button><button data-brauchtum-tab="maiabend" class="brauchtum-tab-btn bg-gray-700 py-2 px-4 rounded-full">Maiabend</button><button data-brauchtum-tab="strohbaertreiben" class="brauchtum-tab-btn bg-gray-700 py-2 px-4 rounded-full">Strohbärtreiben</button><button data-brauchtum-tab="martinstag" class="brauchtum-tab-btn bg-gray-700 py-2 px-4 rounded-full">Martinstag</button><button data-brauchtum-tab="faehndelschwenken" class="brauchtum-tab-btn bg-gray-700 py-2 px-4 rounded-full">Fähndelschwenken</button></div></div><div id="brauchtum-content" class="mt-8"></div></div></section>
                <section id="impressum" class="page-section hidden py-20"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Impressum</h2></div><div class="max-w-2xl mx-auto bg-gray-800 p-8 rounded-lg shadow-lg"><div id="impressum-text" class="prose-invert max-w-none"></div></div></div></section>
                <section id="datenschutz" class="page-section hidden py-20 bg-gray-900"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Datenschutzerklärung</h2></div><div class="max-w-2xl mx-auto bg-gray-800 p-8 rounded-lg shadow-lg"><div id="datenschutz-text" class="prose-invert max-w-none"></div></div></div></section>
                <section id="admin-dashboard" class="page-section hidden py-20"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Admin Dashboard</h2><p class="max-w-3xl mx-auto text-lg text-gray-400">Zentrale Verwaltung der Webseite.</p></div><div id="dashboard-content"></div></div></section>
                <section id="member-area" class="page-section hidden py-20 bg-blue-900/10"><div class="container mx-auto px-6"><div class="text-center mb-12"><h2 class="text-4xl font-bold mb-4">Mitgliederbereich</h2><p class="max-w-3xl mx-auto text-lg text-gray-400">Willkommen im exklusiven Bereich für unsere Vereinsmitglieder.</p><div class="flex justify-center space-x-2 mt-6"><button data-member-tab="koenigstipp" class="member-tab-btn bg-blue-500 text-white py-2 px-4 rounded-full">Königstipp</button><button data-member-tab="dienstplan" class="member-tab-btn bg-gray-700 py-2 px-4 rounded-full">Dienstplan</button><button data-member-tab="dokumente" class="member-tab-btn bg-gray-700 py-2 px-4 rounded-full">Dokumente</button></div></div><div id="member-content" class="mt-8"></div></div></section>
            `;
        }
        
        // --- All other functions (event handlers, specific renderers) follow here ---
        // ... (Full JS code is too long for this snippet, but it's in the final file)

    </script>
</body>
</html>

